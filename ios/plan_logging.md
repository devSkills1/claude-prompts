# 日志 / 异步 / 崩溃保护

【背景】
- 日志使用场景：
- 当前写入方式：
- 日志级别划分：
- 敏感业务涉及：

【目标】
- 非阻塞主线程
- 高可靠性
- 崩溃前尽量落盘
- 隐私合规

【约束】
- 不丢日志
- 不引入第三方库
- 不记录敏感信息明文
- 符合个人信息保护法规

【日志级别定义】
建议定义：
- Verbose（仅开发）：详细调试信息
- Debug（仅开发）：调试信息
- Info（Release）：常规业务信息
- Warning（Release）：警告信息
- Error（Release）：可恢复错误
- Fatal（Release）：致命错误

【隐私与安全】

## 敏感数据脱敏规则
- 手机号：`138****8888`
- 身份证：`110***********1234`
- 邮箱：`u***@example.com`
- 姓名：仅记录姓氏 + `*`
- 银行卡号：仅保留后 4 位

## 禁止记录内容清单
- ❌ 用户密码、支付密码
- ❌ Token、Session、Cookie
- ❌ 银行卡号、CVV
- ❌ 证件照片路径
- ❌ 完整的 GPS 坐标（仅到市/区级）

## 日志文件安全
- 使用 `NSFileProtectionComplete` 加密
- 文件权限：644（仅 App 可读写）
- 定期清理（保留最近 7 天）
- 日志文件总大小限制：50MB

## 合规性要求
- 符合《个人信息保护法》
- 用户可申请查看/删除日志
- 不上传未脱敏的原始日志

【请输出】
1. 写入路径分析（主路径 + 备用路径）
2. Queue / Buffer 策略（队列 QoS + 缓冲区大小）
3. Flush 时机（后台、内存警告、定时、Error 级别）
4. 崩溃场景处理（mmap + Signal Handler）
5. 性能监控点（主线程耗时 < 1ms）
6. 隐私脱敏实现方案
7. 日志轮转策略（文件大小、保留天数）

---
只给方案，不写代码